(function(r,a){typeof exports=="object"&&typeof module<"u"?module.exports=a():typeof define=="function"&&define.amd?define(a):(r=typeof globalThis<"u"?globalThis:r||self,r["quill-image-resizor"]=a())})(this,function(){"use strict";var u;const r={modules:["DisplaySize","Toolbar","Resize"],overlayStyles:{position:"absolute",boxSizing:"border-box",border:"1px dashed #444"},handleStyles:{position:"absolute",height:"12px",width:"12px",backgroundColor:"white",border:"1px solid #777",boxSizing:"border-box",opacity:"0.80"},displayStyles:{position:"absolute",font:"12px/1.0 Arial, Helvetica, sans-serif",padding:"4px 8px",textAlign:"center",backgroundColor:"white",color:"#333",border:"1px solid #777",boxSizing:"border-box",opacity:"0.80",cursor:"default"},toolbarStyles:{position:"absolute",top:"-12px",right:"0",left:"0",height:"0",minWidth:"100px",font:"12px/1.0 Arial, Helvetica, sans-serif",textAlign:"center",color:"#333",boxSizing:"border-box",cursor:"default"},toolbarButtonStyles:{display:"inline-block",width:"24px",height:"24px",background:"white",border:"1px solid #999",verticalAlign:"middle"},toolbarButtonSvgStyles:{fill:"#444",stroke:"#444",strokeWidth:"2"}};class a{constructor(n){this.onCreate=()=>{},this.onDestroy=()=>{},this.onUpdate=()=>{},this.overlay=n.overlay,this.img=n.img,this.options=n.options,this.requestUpdate=n.onUpdate}}class g extends a{constructor(n){super(n),this.display=null,this.onCreate=()=>{var t;this.display=document.createElement("div"),Object.assign(this.display.style,this.options.displayStyles),(t=this.overlay)==null||t.appendChild(this.display)},this.onDestroy=()=>{},this.onUpdate=()=>{if(!this.display||!this.img)return;const t=this.getCurrentSize();if(this.display.innerHTML=t.join(" &times; "),t[0]>120&&t[1]>30)Object.assign(this.display.style,{right:"4px",bottom:"4px",left:"auto"});else if(this.img.style.float=="right"){const e=this.display.getBoundingClientRect();Object.assign(this.display.style,{right:"auto",bottom:`-${e.height+4}px`,left:`-${e.width+4}px`})}else{const e=this.display.getBoundingClientRect();Object.assign(this.display.style,{right:`-${e.width+4}px`,bottom:`-${e.height+4}px`,left:"auto"})}},this.getCurrentSize=()=>{var t;return[((t=this.img)==null?void 0:t.width)||0,this.img?Math.round(this.img.width/this.img.naturalWidth*this.img.naturalHeight):0]}}}const m=`<svg viewbox="0 0 18 18">
  <line class="ql-stroke" x1="3" x2="15" y1="9" y2="9"></line>
  <line class="ql-stroke" x1="3" x2="13" y1="14" y2="14"></line>
  <line class="ql-stroke" x1="3" x2="9" y1="4" y2="4"></line>
</svg>`,y=`<svg viewbox="0 0 18 18">
  <line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"></line>
  <line class="ql-stroke" x1="14" x2="4" y1="14" y2="14"></line>
  <line class="ql-stroke" x1="12" x2="6" y1="4" y2="4"></line>
</svg>`,f=`<svg viewbox="0 0 18 18">
  <line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"></line>
  <line class="ql-stroke" x1="15" x2="5" y1="14" y2="14"></line>
  <line class="ql-stroke" x1="15" x2="9" y1="4" y2="4"></line>
</svg>`;class b extends a{constructor(n){super(n),this.alignments=[],this.onCreate=()=>{var t;this.toolbar=document.createElement("div"),Object.assign(this.toolbar.style,this.options.toolbarStyles),(t=this.overlay)==null||t.appendChild(this.toolbar),this._defineAlignments(),this._addToolbarButtons()},this.onDestroy=()=>{},this.onUpdate=()=>{},this._defineAlignments=()=>{this.alignments=[{icon:m,apply:()=>{var t;(t=this.img)!=null&&t.parentElement&&(this.img.parentElement.classList.remove("ql-align-center"),this.img.parentElement.classList.remove("ql-align-right"))},isApplied:()=>{var t;return(t=this.img)!=null&&t.parentElement?!this.img.parentElement.classList.contains("ql-align-center")&&!this.img.parentElement.classList.contains("ql-align-right"):!1}},{className:"ql-align-center",icon:y,apply:()=>{var t;(t=this.img)!=null&&t.parentElement&&(this.img.parentElement.classList.add("ql-align-center"),this.img.parentElement.classList.remove("ql-align-right"))},isApplied:()=>{var t;return(t=this.img)!=null&&t.parentElement?this.img.parentElement.classList.contains("ql-align-center"):!1}},{className:"ql-align-right",icon:f,apply:()=>{var t;(t=this.img)!=null&&t.parentElement&&(this.img.parentElement.classList.add("ql-align-right"),this.img.parentElement.classList.remove("ql-align-center"))},isApplied:()=>{var t;return(t=this.img)!=null&&t.parentElement?this.img.parentElement.classList.contains("ql-align-right"):!1}}]},this._addToolbarButtons=()=>{const t=[];this.alignments.forEach((e,o)=>{var s;const l=document.createElement("span");t.push(l),l.innerHTML=e.icon,l.addEventListener("click",()=>{var i;t.forEach(h=>h.style.filter=""),e.isApplied()?(i=this.img)!=null&&i.parentElement&&e.className&&this.img.parentElement.classList.remove(e.className):(this._selectButton(l),e.apply()),this.requestUpdate()}),Object.assign(l.style,this.options.toolbarButtonStyles),o>0&&(l.style.borderLeftWidth="0"),Object.assign(l.children[0].style,this.options.toolbarButtonSvgStyles),e.isApplied()&&this._selectButton(l),(s=this.toolbar)==null||s.appendChild(l)})},this._selectButton=t=>{t.style.filter="invert(20%)"}}}class x extends a{constructor(n){super(n),this.boxes=[],this.dragBox=null,this.dragStartX=0,this.preDragWidth=0,this.onCreate=()=>{this.boxes=[],this.addBox("nwse-resize"),this.addBox("nesw-resize"),this.addBox("nwse-resize"),this.addBox("nesw-resize"),this.positionBoxes()},this.onDestroy=()=>{this.setCursor("")},this.positionBoxes=()=>{var o,l;const t=`${-parseFloat(((o=this.options.handleStyles)==null?void 0:o.width.toString())||"0")/2}px`,e=`${-parseFloat(((l=this.options.handleStyles)==null?void 0:l.height.toString())||"0")/2}px`;[{left:t,top:e},{right:t,top:e},{right:t,bottom:e},{left:t,bottom:e}].forEach((s,i)=>{Object.assign(this.boxes[i].style,s)})},this.addBox=t=>{var o,l,s;const e=document.createElement("div");Object.assign(e.style,this.options.handleStyles),e.style.cursor=t,e.style.width=`${((o=this.options.handleStyles)==null?void 0:o.width)||0}px`,e.style.height=`${((l=this.options.handleStyles)==null?void 0:l.height)||0}px`,e.addEventListener("mousedown",this.handleMousedown,!1),(s=this.overlay)==null||s.appendChild(e),this.boxes.push(e)},this.handleMousedown=t=>{var e,o;this.dragBox=t.target,this.dragStartX=t.clientX,this.preDragWidth=((e=this.img)==null?void 0:e.width)||((o=this.img)==null?void 0:o.naturalWidth)||0,this.setCursor(this.dragBox.style.cursor),document.addEventListener("mousemove",this.handleDrag,!1),document.addEventListener("mouseup",this.handleMouseup,!1)},this.handleMouseup=()=>{this.setCursor(""),document.removeEventListener("mousemove",this.handleDrag),document.removeEventListener("mouseup",this.handleMouseup)},this.handleDrag=t=>{if(!this.img)return;const e=t.clientX-this.dragStartX;this.dragBox===this.boxes[0]||this.dragBox===this.boxes[3]?this.img.width=Math.round(this.preDragWidth-e):this.img.width=Math.round(this.preDragWidth+e),this.requestUpdate()},this.setCursor=t=>{[document.body,this.img].forEach(o=>{o&&(o.style.cursor=t)})}}}const v=Object.freeze(["userSelect","mozUserSelect","webkitUserSelect","msUserSelect"]),S={DisplaySize:g,Toolbar:b,Resize:x},d=class d{constructor(n,t={}){var o,l;this.moduleClasses=[],this.modules=[],this.onUpdate=()=>{this.repositionElements(),this.modules.forEach(s=>{s.onUpdate()})},this.removeModules=()=>{this.modules.forEach(s=>{s.onDestroy()}),this.modules=[]},this.handleClick=s=>{var h;const i=s.target;if(((h=i==null?void 0:i.tagName)==null?void 0:h.toUpperCase())==="IMG"){if(this.img===i)return;this.img&&this.hide(),this.show(i)}else this.img&&this.hide()},this.show=s=>{this.img=s,this.showOverlay(),this.initializeModules()},this.showOverlay=()=>{this.overlay&&this.hideOverlay(),this.quill.setSelection(null),this.setUserSelect("none"),document.addEventListener("keyup",this.checkImageKeyUp,!0),this.quill.root.addEventListener("input",this.checkImageInput,!0),window.addEventListener("resize",this.repositionElements),this.overlay=document.createElement("div"),this.overlay.classList.add("ql-image-resizor"),Object.assign(this.overlay.style,this.options.overlayStyles),this.quill.root.parentNode.appendChild(this.overlay),this.repositionElements()},this.hideOverlay=()=>{this.overlay&&(this.quill.root.parentNode.removeChild(this.overlay),this.overlay=void 0,document.removeEventListener("keyup",this.checkImageKeyUp),this.quill.root.removeEventListener("input",this.checkImageInput),window.removeEventListener("resize",this.repositionElements),this.setUserSelect(""))},this.repositionElements=()=>{if(!this.overlay||!this.img)return;const s=this.quill.root.parentNode,i=this.img.getBoundingClientRect(),h=s.getBoundingClientRect();Object.assign(this.overlay.style,{left:`${i.left-h.left-1+s.scrollLeft}px`,top:`${i.top-h.top+s.scrollTop}px`,width:`${i.width}px`,height:`${i.height}px`})},this.hide=()=>{this.hideOverlay(),this.removeModules(),this.img=void 0},this.setUserSelect=s=>{v.forEach(i=>{this.quill.root.style[i]=s,document.documentElement.style[i]=s})},this.checkImageKeyUp=s=>{var i;if(this.img){if(["Backspace","Delete"].includes(s.code)){const h=(i=d.Quill)==null?void 0:i.find(this.img);h&&h.deleteAt(0)}this.hide()}},this.checkImageInput=s=>{var i;if(this.img){if(["deleteContentForward","deleteContentBackward"].includes(s.inputType)){const h=(i=d.Quill)==null?void 0:i.find(this.img);h&&h.deleteAt(0)}this.hide()}},this.initializeModules=this.initializeModules.bind(this),this.quill=n,this.options={modules:(o=t.modules)!=null&&o.length?t.modules:r.modules,displayStyles:{...r.displayStyles,...t.displayStyles},handleStyles:{...r.handleStyles,...t.handleStyles},overlayStyles:{...r.overlayStyles,...t.overlayStyles},toolbarButtonStyles:{...r.toolbarButtonStyles,...t.toolbarButtonStyles},toolbarButtonSvgStyles:{...r.toolbarButtonSvgStyles,...t.toolbarButtonSvgStyles},toolbarStyles:{...r.toolbarStyles,...t.toolbarStyles}},(l=t.modules)!=null&&l.length&&(this.moduleClasses=t.modules.slice()),this.quill.root.addEventListener("click",this.handleClick,!1);const e=this.quill.root.parentNode;e.style.position=e.style.position||"relative",this.modules=[],this.moduleClasses=this.options.modules||[]}initializeModules(){var n;this.removeModules(),this.modules=((n=this.moduleClasses)==null?void 0:n.map(t=>new(S[t]||t)(this)))||[],this.modules.forEach(t=>{t.onCreate()}),this.onUpdate()}};d.Quill=window.Quill??null;let c=d;return(u=window.Quill)==null||u.register("modules/imageResizor",c),c});
